mutation CreateConversation {
    createConversation {
        conversation {
            ...ConversationFragment
        }
    }
}

query Conversation($id: UUID!, $pageInfo: OpaqueCursorPage!) {
    conversation(id: $id) {
        conversation {
            ...ConversationFragment
            ...ConversationMessagesPageFragment
        }
    }
}

query ConversationList($pageInfo: OpaqueCursorPage!) {
    conversations(page: $pageInfo) {
        conversations {
            ...ConversationFragment
        }
        hasMore
        nextCursor
    }
}

subscription ConversationsEvents {
    conversations {
        ... on ConversationCreatedEvent {
            conversation {
                ...ConversationFragment
            }
        }
        ... on ConversationUpdatedEvent {
            conversation {
                ...ConversationFragment
            }
        }
        ... on ConversationDeletedEvent {
            conversationID
        }
    }
}

subscription ConversationEvents($conversationId: UUID!) {
    conversation(id: $conversationId) {
        ... on MessageCreatedEvent {
            message {
                ...MessageFragment
            }
        }
        ... on MessageUpdatedEvent {
            message {
                ...MessageFragment
            }
        }
    }
}

fragment ConversationFragment on Conversation {
    __typename
    id
    title
    description
    lastMessagePreview
    unreadMessageCount
    providers {
        ...ProviderInConversationFragment
    }
}

fragment ConversationMessagesPageFragment on Conversation {
    items(page: $pageInfo) {
        data {
            ...MessageFragment
        }
        hasMore
        nextCursor
    }
}

fragment MessageFragment on Message {
    __typename
    id
    author {
        ... on Provider {
            ...ProviderFragment
        }
        ... on Patient {
            ...PatientFragment
        }
    }
    content {
        ... on TextMessageContent {
            ...TextMessageContentFragment
        }
        ... on ImageMessageContent {
            ...ImageMessageContentFragment
        }
        ... on DocumentMessageContent {
            ...DocumentMessageContentFragment
        }
        ... on DeletedMessageContent {
            ...DeletedMessageContentFragment
        }
    }
    clientId
    conversation {
        id
    }
}

fragment ProviderInConversationFragment on ProviderInConversation {
    id
    provider {
        ...ProviderFragment
    }
    isTyping
    seenUntil
}

fragment ProviderFragment on Provider {
    id
    avatarUrl {
        ...EphemeralUrlFragment
    }
}

fragment PatientFragment on Patient {
    id
}

fragment EphemeralUrlFragment on EphemeralUrl {
    expiresAt
    url
}

fragment TextMessageContentFragment on TextMessageContent {
    text
}

fragment ImageMessageContentFragment on ImageMessageContent {
    fileUpload {
        ...ImageFileUploadFragment
    }
}

fragment DocumentMessageContentFragment on DocumentMessageContent {
    title
    fileUpload {
        ...DocumentFileUploadFragment
    }
}

fragment DeletedMessageContentFragment on DeletedMessageContent {
    empty: _
}

fragment ImageFileUploadFragment on ImageFileUpload {
    uuid
    url {
        ...EphemeralUrlFragment
    }
    fileName
    mimeType
    width
    height
}

fragment DocumentFileUploadFragment on DocumentFileUpload {
    uuid
    url {
        ...EphemeralUrlFragment
    }
    fileName
    mimeType
    thumbnail {
        ...ImageFileUploadFragment
    }
}
